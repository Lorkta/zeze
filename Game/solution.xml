<?xml version="1.0" encoding="utf-8"?>

<solution name="Game" ModuleIdAllowRanges="1-100,101">
	<module name="Login" id="1">
		<bean name="BRole">
			<variable id="1" name="Id" type="long"/>
			<variable id="2" name="Name" type="string"/>
		</bean>
		<bean name="BRoles">
			<variable id="1" name="RoleList" type="list" value="BRole"/>
			<variable id="2" name="LastLoginRoleId" type="long"/>
		</bean>
		<bean name="BLogin">
			<variable id="1" name="RoleId" type="long"/>
		</bean>
		<bean name="BAuth">
			<variable id="1" name="Account" type="string"/>
			<variable id="2" name="Token" type="string"/> security. maybe password
		</bean>
		<bean name="BAuthResult">
			<variable id="1" name="Account" type="string"/>
		</bean>

		<protocol name="CCreateRole" id="1" argument="BRole" handle="server"/>
		<protocol name="SCreateRole" id="2" argument="BRole" handle="client">
			<enum name="ResultSuccess" value="0"/>
			<enum name="ResultFaild" value="1"/>
		</protocol>
		<protocol name="CGetRoleList" id="3" handle="server"/>
		<protocol name="SGetRoleList" id="4" argument="BRoles" handle="client"/>
		<protocol name="CLogin" id="5" argument="BLogin" handle="server"/>
		<protocol name="SLogin" id="6" argument="BLogin" handle="client"/>
		<protocol name="CLogout" id="10" argument="BLogin" handle="server"/>
		<protocol name="SLogout" id="11" argument="BLogin" handle="client"/>

		<!-- 只有账号验证，不包含注册功能 -->
		<protocol name="CAuth" id="100" argument="BAuth" handle="server"/>
		<protocol name="SAuth" id="101" argument="BAuthResult" handle="client">
			<enum name="ResultSuccess" value="0"/>
			<enum name="ResultFaild" value="1"/>
		</protocol>

		<bean name="BAccount">
			<variable id="1" name="Name" type="string"/>
			<variable id="2" name="Token" type="string"/>
			<variable id="3" name="Roles" type="list" value="long"/> roleid list
			<variable id="4" name="SocketSessionId" type="long"/> for kick
			<variable id="5" name="LastLoginRoleId" type="long"/>
		</bean>
		<bean name="BRoleData">
			<variable id="1" name="Name" type="string"/>
		</bean>
		<bean name="BRoleId">
			<variable id="1" name="Id" type="long"/>
		</bean>
		<bean name="BOnline">
			<variable id="1" name="SessionId" type="long"/>
			<variable id="2" name="RoleId" type="long"/>
		</bean>

		<table name="taccount" key="string" value="BAccount"/>
		<table name="trole" key="long" value="BRoleData" autokey="true"/>
		<table name="trolename" key="string" value="BRoleId"/> rolename to roleid. duplicate name check
		<table name="tonline" key="long" value="BOnline" memory="true" autokey="true"/>
	</module>

	<module name="Bag" id="2">
		<bean name="BMove">
			<variable id="1" name="PositionFrom" type="int"/>
			<variable id="2" name="PositionTo" type="int"/>
			<variable id="3" name="number" type="int"/> -1 表示全部
		</bean>
		<bean name="BDestroy">
			<variable id="1" name="Position" type="int"/>
		</bean>
		<bean name="BResult">
			<variable id="1" name="ItemsReplace" type="map" key="int" value="BItem"/> key is position
			<variable id="2" name="ItemsRemove" type="set" value="int"/> key is position
		</bean>

		<protocol name="CMove" id="1" argument="BMove" handle="server"/>
		<protocol name="CDestroy" id="2" argument="BDestroy" handle="server"/>
		<protocol name="CSort" id="3" handle="server"/>
		<protocol name="SChanged" id="4" argument="BResult" handle="client"/>

		<bean name="BItem">
			<variable id="1" name="Id" type="int"/>
			<variable id="2" name="Type" type="int"/>
			<variable id="3" name="Number" type="int"/>
			<variable id="4" name="Extrakey" type="long"/>
		</bean>
		<bean name="BBag">
			<variable id="1" name="Money" type="long"/>
			<variable id="2" name="Capacity" type="int"/>
			<variable id="3" name="Items" type="map" key="int" value="BItem"/> key is position
		</bean>
		<table name="tbag" key="long" value="BBag"/>
	</module>

	<module name="Item" id="3">
	</module>

	<module name="Fight" id="4">
	</module>

	<module name="Buf" id="5">
	</module>

	<module name="Equip" id="6">
		<table name="tequip" key="long" value="Game.Bag.BItem"/>
	</module>

	<module name="Map" id="7">
		<bean name="BEnterWorldNow">
			<variable id="1" name="MapInstanceId" type="int"/>
			<!-- role postion -->
			<variable id="2" name="x" type="float"/>
			<variable id="3" name="y" type="float"/>
			<variable id="4" name="z" type="float"/>
			<!-- parameter for client resource -->
			<variable id="5" name="ResouceId" type="int"/>
		</bean>
		<bean name="BEnterWorldDone">
			<variable id="1" name="MapInstanceId" type="int"/>
		</bean>

		<protocol name="CEnterWorld" id="1" handle="server"/> no argument. all in server
		<protocol name="SEnterWorldNow" id="2" argument="BEnterWorldNow" handle="client"/>
		<protocol name="CEnterWorldDone" id="3" argument="BEnterWorldDone" handle="server"/> client load resource done
	</module>

	<!--
	name 项目名字
	gendir 代码生成输出目录，默认是当前目录
	GenTables 选择生成哪些表格（Table），如果为空，那就生成那些没有配置gen属性的table，可以用','分开指定多个名字
	-->
	<project name="server" gendir="." platform="cs" GenTables="">
		<!--
		这里引用的模块不该定义协议，定义了也不会被生成，一般为纯逻辑或者数据库模块。
		<module ref="CommonModule"/>
		-->
		<!-- service 生成到 solution 名字空间下 -->
		<service name="Server" handle="server" base="Zeze.Services.HandshakeServer">
			<module ref="Login"/>
			<module ref="Bag"/>
			<module ref="Item"/>
			<module ref="Fight"/>
			<module ref="Buf"/>
			<module ref="Equip"/>
			<module ref="Map"/>
		</service>
	</project>

	<project name="client" gendir="." platform="cs" GenTables="client">
		<service name="Client" handle="client" base="Zeze.Services.HandshakeClient">
		</service>
	</project>

</solution>
